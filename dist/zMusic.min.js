!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("zMusic",[],e):"object"==typeof exports?exports.zMusic=e():t.zMusic=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e,n){"use strict";var i={getTime:function(t){var e=Math.floor(t/60),n=Math.floor(t%60);return(e>=10?e:"0"+e)+":"+(n>=10?n:"0"+n)},leftDistance:function(t){for(var e=t.offsetLeft,n=void 0;t.offsetParent;)t=t.offsetParent,e+=t.offsetLeft;return n=document.body.scrollLeft+document.documentElement.scrollLeft,e-n},ajax:function(t){t.beforeSend&&t.beforeSend();var e=t.url;return t.songId&&(e+="?channel="+t.songId),new Promise(function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==i.readyState)if(4==i.readyState&&(i.status>="200"||"304"==i.status)){var e=JSON.parse(i.responseText);t(e)}else n(i.status)},i.onerror=function(){n("ajax error")},i.open("get",e,!0),i.send()})}};t.exports=i},function(t,e,n){"use strict";function i(){var t=' \n            <div id="player">\n                <div class="music-photo-ct">\n                    <div class="music-photo" style="background-image: url('+this.songData[0].picture+');"></div>\n                </div>\n                <h3>'+this.songData[0].title+"</h3>\n                <p>"+this.songData[0].artist+'</p>\n                <div class="line">\n                    <div class="line-loading"></div>\n                    <div class="play-time">\n                        <div></div>\n                        <span class="cur">--:--</span>/<span class="total">--:--</span>\n                    </div>\n                </div>\n                <div class="btns">\n                    <div class="btn random"></div>\n                    <div class="btn play">\n                        <div class="icon-play"></div>\n                    </div>\n                    <div class="btn next"></div>\n                    <div class="collect"><img src="./dist/'+o+'" alt=""></div>\n                </div>\n            </div>\n            <div id="album-list">\n                <div class="list-ct">\n                    <ul class="clearfix">';for(var e in this.albumData)t+='<li data-index="'+e+'">\n                    <h4 data-index="'+e+'">'+this.albumData[e].name+'</h4>\n                    <div data-index="'+e+'" style="background-image: url('+this.albumData[e].cover_small+');">\n                    </div>\n                    <span class="ds"></span>\n                </li>';return t+="\n                    </ul>\n                </div >\n            </div > "}var o=n(4);t.exports=i},function(t,e){},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();n(2),console.log("Z-Music 1.0");var s=n(0),a=n(1),l="//api.jirengu.com/fm/getChannels.php",c="//api.jirengu.com/fm/getSong.php",r=function(){function t(){var e=this;i(this,t),this.ct=document.getElementById("z-music"),this.albumData={},this.songData={},this.albumIndex=36,this.music=new Audio,this.ct.innerHTML='<div class="zmusic-loading"><p>LOADING...</p></div>',s.ajax({url:l,beforeSend:function(){console.log("正在获取专辑数据")}}).then(function(t){return console.log("成功获得专辑数据"),e.albumData=t.channels,s.ajax({url:c,songId:e.albumData[e.albumIndex].channel_id,beforeSend:function(){console.log("正在获取歌曲数据")}})},function(t){console.log("获取专辑好像出错了!状态码:"+t)}).then(function(t){console.log("成功获得歌曲数据"),e.songData=t.song,e.ct.innerHTML=a.call(e),e.music.src=e.songData[0].url,e.init(),e.bind()},function(t){console.log("获取歌曲好像出错了!状态码:"+t)})}return o(t,[{key:"init",value:function(){this.dom={albums:this.ct.querySelectorAll(".list-ct>ul>li"),albumCt:this.ct.querySelector(".list-ct>ul"),btn_play:this.ct.querySelector(".btns>.play"),btn_play_icon:this.ct.querySelector(".btns>.play>.icon-play"),btn_next:this.ct.querySelector(".btns>.next"),btn_random:this.ct.querySelector(".btns>.random"),btn_collect:this.ct.querySelector(".btns>.collect"),play_line:this.ct.querySelector(".line"),play_line_loading:this.ct.querySelector(".line>.line-loading"),play_time:this.ct.querySelector(".line>.play-time"),play_loading:this.ct.querySelector(".line>.play-time>div"),time:this.ct.querySelectorAll(".line>.play-time>span"),time_cur:this.ct.querySelector(".line>.play-time>.cur"),time_total:this.ct.querySelector(".line>.play-time>.total"),player_h3:this.ct.querySelector("#player>h3"),player_p:this.ct.querySelector("#player>p"),player_music_photo_ct:this.ct.querySelector("#player>.music-photo-ct"),player_music_photo:this.ct.querySelector("#player>.music-photo-ct>.music-photo")},this.layout()}},{key:"bind",value:function(){var t=this;this.music.addEventListener("durationchange",function(e){var n=t.music.duration.toString();t.dom.time_total.innerHTML=s.getTime(n)});var e=!0;this.music.addEventListener("timeupdate",function(n){e&&(e=!1,setTimeout(function(){var n=t.music.currentTime.toString();t.dom.time_cur.innerHTML=s.getTime(n),t.dom.play_time.style.left=t.music.currentTime/t.music.duration*100+"%",e=!0},1e3))}),this.music.addEventListener("progress",function(e){var n=t.music.buffered.length?t.music.buffered.end(t.music.buffered.length-1)/t.music.duration:0;t.dom.play_line_loading.style.width=100*n+"%"}),this.music.addEventListener("waiting",function(e){console.log("不能播放哦"),t.dom.play_loading.classList.add("loading")}),this.music.addEventListener("canplay",function(e){console.log("可以播放哦"),t.dom.play_loading.classList.remove("loading")}),this.music.addEventListener("ended",function(e){t.getMusic(t.albumIndex)}),this.dom.btn_play.addEventListener("click",function(){t.playToggle()}),this.dom.btn_random.addEventListener("click",function(){console.log("单击循环"),t.loopToggle(),console.log(t.music.loop)}),this.dom.btn_next.addEventListener("click",function(){console.log("下一曲"),t.getMusic(t.albumIndex)}),this.dom.albumCt.addEventListener("click",function(e){var n=e||window.event,i=n.target,o=i.getAttribute("data-index");o&&(t.albumIndex=o,t.getMusic(t.albumIndex))}),this.dom.play_line.addEventListener("click",function(e){var n=e||window.event,i=(n.clientX-s.leftDistance(t.dom.play_line))/t.dom.play_line.clientWidth;isNaN(t.music.duration)||(t.dom.play_time.style.left=100*i+"%",t.dom.time_cur.innerHTML=s.getTime(i*t.music.duration),t.music.currentTime=i*t.music.duration)}),this.dom.btn_collect.addEventListener("click",function(t){console.log("测试")})}},{key:"play",value:function(){this.music.paused&&(this.music.play(),this.dom.btn_play_icon.classList.add("icon-pause"),this.dom.player_music_photo.classList.add("disk"))}},{key:"pause",value:function(){this.music.paused||(this.music.pause(),this.dom.btn_play_icon.classList.remove("icon-pause"),this.setTransform(),this.dom.player_music_photo.classList.remove("disk"))}},{key:"playToggle",value:function(){console.log("进入切换"),this.music.paused?this.play():this.pause()}},{key:"getMusic",value:function(t){var e=this;s.ajax({url:c,songId:this.albumData[t].channel_id,beforeSend:function(){console.log("正在获取歌曲数据")}}).then(function(t){console.log("成功获得歌曲数据"),e.songData=t.song,e.render_player(),e.music.src=e.songData[0].url,e.play()},function(t){console.log("获取歌曲好像出错了!状态码:"+t)})}},{key:"loopOn",value:function(){this.music.loop=!0,this.dom.btn_random.classList.add("loop")}},{key:"loopOff",value:function(){this.music.loop=!1,this.dom.btn_random.classList.remove("loop")}},{key:"loopToggle",value:function(){this.music.loop?this.loopOff():this.loopOn()}},{key:"layout",value:function(){var t=this.albumData.length,e=function(t,e){return t.currentStyle?t.currentStyle:window.getComputedStyle(t,e)}(this.dom.albums[1],null),n=parseInt(e.width),i=parseInt(e.marginLeft);this.dom.albumCt.style.width=(t+1)*(n+i)+"px"}},{key:"render_player",value:function(){this.dom.player_music_photo.setAttribute("style","background-image:url("+this.songData[0].picture+")"),this.dom.player_h3.innerHTML=this.songData[0].title,this.dom.player_p.innerHTML=this.songData[0].artist}},{key:"setTransform",value:function(){var t=document.defaultView.getComputedStyle(this.dom.player_music_photo,null).transform,e=document.defaultView.getComputedStyle(this.dom.player_music_photo_ct,null).transform;this.dom.player_music_photo_ct.style.transform="none"===e?t:t.concat(e)}}]),t}();t.exports=r},function(t,e,n){t.exports=n.p+"collect-yes_N4wMaWi.png"}])});